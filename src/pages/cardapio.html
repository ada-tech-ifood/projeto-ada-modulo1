<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../styles/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <style>
        .carousel-inner img {
            /* width: 600px;
            height: 400px; */
            object-fit: contain;
        }

        .card {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, rgba(166, 247, 80, 0.04) 0%, rgba(166, 247, 80, 0) 69.95%), rgb(24, 28, 35);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 5px 5px 10px #a6f750;
        }

        .quantity-selection {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
            outline: none;
            color: #A6F750;
        }

        .minus-btn {
            padding-right: 5px;
        }

        .plus-btn {
            padding-left: 5px;
        }

        .quantity-value {
            margin: 0 10px;
            font-size: 20px;
        }
    </style>

    <script>
        function decreaseQuantity(id) {
            qty = parseInt(document.getElementById(id).innerText);
            if (qty > 0) {
                document.getElementById(id).innerText = qty - 1;
            }
        }

        function increaseQuantity(id) {
            qty = parseInt(document.getElementById(id).innerText);
            document.getElementById(id).innerText = qty + 1;
        }

        function fetchAndRenderMenu() { // essa funçao busca a lista de comidas (cadastrada na api) e renderiza a lista de comidas cadastradas.
            const apiUrl = 'https://parseapi.back4app.com/classes/menu';
            const headers = {
                'X-Parse-Application-Id': 'm4YkgcYnDUuV486nA7LyuK7BpE0Z4072JURTrgQR', //chaves que o back4app deu para acessar a api.
                'X-Parse-REST-API-Key': 'YoXbAgSt5C3NLFwLO8kFSnnzYLTQ0bXBC993qBzR'
            };

            fetch(apiUrl, { headers }) // esse fetch bate na api enviando informaçõs dos headers e recebendo a lista de comidas cadastradas (como o js bate na api).
                .then(response => response.json()) //json é a resposta que o banco envia pra
                .then(data => {
                    renderMenu(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function renderMenu(data) { // essa funçao renderiza a lista de comidas.
            renderSection(data, 'Lanches');
            renderSection(data, 'Sobremesas');
            renderSection(data, 'Bebidas');
        }

        function renderSection(data, category) { //essa função pega o html que a gente define pras categorias.
            const menuContainer = document.getElementById('menu');
            const section = document.createElement('section');
            section.innerHTML = `
            <div class="row text-center bg-primary rounded py-3 mt-5" style="color: black;">
                <h1><b> ${category} </b></h1>
            </div>
            <div class="row justify-content-center align-items-stretch">
                <div id="items" class="row row-cols-2 g-4">
                </div>
            </div>
        `;

            const itemsContainer = section.querySelector('#items');
            const filteredItems = data.results.filter(food => food.category === category);

            filteredItems.forEach(item => {
                const newItem = createMenuItem(item); // cria o html do card.
                itemsContainer.appendChild(newItem); // adiciona o item na lista de itens.
            });

            menuContainer.appendChild(section); // adiciona a section no menu.
        }

        function createMenuItem(item) {
            const newItem = document.createElement('div');
            newItem.className = 'col';
            newItem.innerHTML = `
            <div class="card container justify-content-center"> 
                <div class="row justify-content-center align-items-center">
                    <div class="col-12 col-md-4 px-0">
                        <img src="${item.image}" class="img-fluid" alt="Imagem do item">
                    </div>
                    <div class="col-md-5">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <h5 class="card-title">${item.title}</h5>
                                </div>
                                <div class="col">
                                    <span class="badge bg-danger rounded-pill px-2 py-2"> ${item.tags} </span>
                                </div>
                            </div>
                            <p class="card-text">${item.description}</p>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="row">
                            <p class="card-title text-center" style="font-size: 16px;">R$ ${item.price.toFixed(2)}</p>
                            <div id="${item.objectId}" class="quantity-selection py-2">
                                <button class="quantity-btn minus-btn" onclick="decreaseQuantity('qty-${item.objectId}');">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <span id="qty-${item.objectId}" class="quantity-value">0</span>
                                <button class="quantity-btn plus-btn" onclick="increaseQuantity('qty-${item.objectId}');">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                            <button class="btn btn-primary">
                                <i class="bi bi-cart-plus"> Adicionar</i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

            return newItem;
        }

        fetchAndRenderMenu();

    </script>

    <title>Cardápio</title>

</head>

<body class="d-flex justify-content-center align-items-center">

    <div class="container">

        <div class="col">
            <div class="d-flex justify-content-between">
                <img style="max-width: 200px;" src="../images/geek_byte.logo.png"
                    alt="Logo da loja contendo uma menina de headset segurando um hamburguer">
            </div>

            <main id="menu"></main>


</body>

</html>